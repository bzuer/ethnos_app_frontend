{% extends "base.html" %}

{% block title %}ethnos_app{% endblock %}

{% block content %}
<div class="page-header" aria-labelledby="page-title">
  <h1 class="page-title" id="page-title">Índex</h1>
</div>


<section aria-labelledby="search-section">
  <h3 class="title-section" id="search-section">Busca no Acervo</h3>
  <form class="search-form" role="search" action="{{ url_for('search_results') }}" method="get" id="search-form">
    <div class="search-input-container">
      <div class="search-input-wrapper">
        <input class="form-input" type="search" id="search-input" name="q" placeholder="Buscar em obras por título, autor ou chave..." aria-label="Termo de busca" autocomplete="off">
        <input class="form-input-ghost" type="text" id="search-ghost" readonly tabindex="-1" aria-hidden="true">
      </div>
      <div class="autocomplete-suggestions" id="autocomplete-suggestions" role="listbox" aria-label="Sugestões de busca"></div>
    </div>
    <button class="search-btn btn-positive" type="submit" aria-label="Executar busca">Buscar</button>
  </form>
</section>

<section aria-labelledby="recent-updates" id="recent-items-section">
  <h3 class="title-section" id="recent-updates">Atualizações Recentes</h3>
  <div class="recent-items-container">
    {% if recent_works %}
    <table class="data-table recent-items-table" aria-describedby="recent-updates">
      <caption class="sr-only">Obras mais recentes adicionadas ao acervo</caption>
      <thead>
        <tr>
          <th scope="col">TÍTULO</th>
          <th scope="col">AUTOR(ES)</th>
          <th scope="col">ANO</th>
        </tr>
      </thead>
      <tbody>
        {% for work in recent_works %}
        <tr>
          <td class="field-value">
            <a class="action-link" href="/work/{{ work.id }}" aria-label="Ver detalhes de {{ work.title }}">
              {{ work.title or 'Título não disponível' }}
            </a>
          </td>
          <td class="field-value">
            {{ work.formatted_authors or 'Autor não informado' }}
          </td>
          <td class="field-value">{{ work.publication_year or 'N/A' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="action-links">
      <a href="/catalog" class="action-btn btn-positive">Ver Todo Catálogo</a>
    </div>
    {% else %}
    <p class="field-value">Nenhuma atualização recente encontrada.</p>
    {% endif %}
  </div>
</section>

<section aria-labelledby="venues-representation" id="venues-section">
  <h3 class="title-section" id="venues-representation">Periódicos por Representação</h3>
  <div class="venues-container">
    {% if top_venues %}
    <table class="data-table homepage-venues-table" aria-describedby="venues-representation">
      <caption class="sr-only">Periódicos com maior número de publicações no acervo</caption>
      <thead>
        <tr>
          <th scope="col">PERIÓDICO</th>
          <th scope="col">PUBLICAÇÕES</th>
          <th scope="col">EDITORA</th>
        </tr>
      </thead>
      <tbody>
        {% for venue in top_venues %}
        <tr>
          <td class="field-value">
            <a class="action-link" href="/venue/{{ venue.id }}" aria-label="Ver detalhes de {{ venue.name }}">
              {{ venue.name or 'Nome não disponível' }}
            </a>
          </td>
          <td class="field-value">{{ '{:,}'.format(venue.works_count or 0).replace(',', '.') }}</td>
          <td class="field-value">{{ venue.publisher_name or 'Não informado' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="action-links">
      <a href="/journals-complete" class="action-btn btn-positive">Ver Todos os Periódicos</a>
    </div>
    {% else %}
    <p class="field-value">Nenhum periódico encontrado.</p>
    {% endif %}
  </div>
</section>


{% if top_organizations %}
<section aria-labelledby="orgs-section" id="orgs-section">
  <h3 class="title-section" id="orgs-section">Instituições Participantes</h3>
  <div class="orgs-container">
    <table class="data-table homepage-orgs-table" aria-describedby="orgs-section">
      <caption class="sr-only">Instituições com maior participação no acervo por número de pesquisadores</caption>
      <thead>
        <tr>
          <th scope="col">INSTITUIÇÃO</th>
          <th scope="col">TIPO</th>
          <th scope="col">PESQUISADORES</th>
        </tr>
      </thead>
      <tbody>
        {% for org in top_organizations %}
        <tr>
          <td class="field-value">
            <a class="action-link" href="/organization/{{ org.id }}" aria-label="Ver detalhes de {{ org.name }}">
              {{ org.name or 'Nome não disponível' }}
            </a>
          </td>
          <td class="field-value">{{ org.type or 'Não informado' }}</td>
          <td class="field-value">{{ '{:,}'.format(org.persons_count or 0).replace(',', '.') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="action-links">
      <a href="/organizations-complete" class="action-btn btn-positive">Ver Todas as Instituições</a>
    </div>
  </div>
</section>
{% endif %}

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/search.min.js') }}?v=20250820-9"></script>
{% endblock %}
