class ClientCache{constructor(){this.cache=new Map,this.cacheTimeout=6e5,this.storageKey="ethnos_app_cache",this.loadFromStorage()}_getCacheKey(e){return e}_isValidCacheEntry(e){return e&&Date.now()-e.timestamp<this.cacheTimeout}get(e){const t=this._getCacheKey(e),a=this.cache.get(t);return this._isValidCacheEntry(a)?a.data:(a&&this.cache.delete(t),null)}set(e,t){const a=this._getCacheKey(e),o={data:t,timestamp:Date.now()};this.cache.set(a,o),this.saveToStorage()}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e),a=Date.now();for(const[e,o]of Object.entries(t))a-o.timestamp<this.cacheTimeout&&this.cache.set(e,o)}}catch(e){console.warn("Failed to load cache from storage:",e)}}saveToStorage(){try{const e={};for(const[t,a]of this.cache.entries())this._isValidCacheEntry(a)&&(e[t]=a);localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.warn("Failed to save cache to storage:",e)}}clear(){this.cache.clear(),localStorage.removeItem(this.storageKey)}}const clientCache=new ClientCache;async function preloadEssentialData(){try{if(window.INITIAL_DATA)return clientCache.set("homepage_data",window.INITIAL_DATA),void delete window.INITIAL_DATA;clientCache.get("homepage_data")||"/"!==window.location.pathname||fetch("/api/preload/homepage").then(e=>e.json()).then(e=>{e&&"success"===e.status&&clientCache.set("homepage_data",e.data)}).catch(e=>console.debug("Background preload failed:",e))}catch(e){console.debug("Preload error:",e)}}function loadMyListScript(){var e=document.createElement("script");e.src="/static/js/my-list.min.js",e.onload=function(){console.log("MyList module loaded"),updateReadingListCounter()},e.onerror=function(){console.error("Failed to load MyList module")},document.head.appendChild(e)}function updateReadingListCounter(){var e,t=document.getElementById("reading-list-counter");t&&window.MyList&&(e=(e=window.MyList.getPersonalList())?e.length:0,t.textContent=e,t.style.display=0<e?"inline":"none")}function loadScript(e){return new Promise((t,a)=>{var o=document.createElement("script");o.src=e,o.onload=t,o.onerror=a,document.head.appendChild(o)})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("search-form");let t=document.getElementById("search-input");e&&e.addEventListener("submit",function(e){e.preventDefault(),(e=t.value.trim())&&(window.location.href="/results?q="+encodeURIComponent(e))}),window.MyList||loadMyListScript(),updateReadingListCounter(),preloadEssentialData()}),window.updateReadingListCounter=updateReadingListCounter;