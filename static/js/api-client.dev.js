class ethnos_appAPI{constructor(){this.baseURL="/api/v2",this.cache=new Map,this.cacheTimeout=3e5,this.requestTimeout=15e3}_getCacheKey(e,t){return e+"_"+JSON.stringify(t||{})}_isValidCacheEntry(e){return e&&Date.now()-e.timestamp<this.cacheTimeout}async _fetch(t,a={},e=2){var s=this._getCacheKey(t,a),r=this.cache.get(s);if(this._isValidCacheEntry(r))return r.data;let n;var i=e+1;for(let r=1;r<=i;r++)try{let e=new AbortController;var o=setTimeout(()=>e.abort(),this.requestTimeout),c={...a,signal:e.signal,headers:{"Content-Type":"application/json",...a.headers}},h=await fetch(""+this.baseURL+t,c);if(clearTimeout(o),!h.ok)throw new Error(`API Error: ${h.status} `+h.statusText);var u=await h.json();if("error"===u.status)throw new Error(u.error||"API returned error status");return this.cache.set(s,{data:u,timestamp:Date.now()}),100<this.cache.size&&this._cleanCache(),u}catch(e){if("AbortError"===(n=e).name?console.warn(`Request timeout (attempt ${r}/${i}):`,t):console.warn(`API fetch error (attempt ${r}/${i}):`,e.message),!(r<i)){if("AbortError"===e.name)throw new Error("Timeout ao carregar dados. Tente recarregar a pÃ¡gina.");throw console.error("All retry attempts failed:",e),e}{let t=1e3*r;console.log(`Retrying in ${t}ms...`),await new Promise(e=>setTimeout(e,t))}}throw n}_cleanCache(){var e,t,r=Date.now();for([e,t]of this.cache.entries())r-t.timestamp>this.cacheTimeout&&this.cache.delete(e)}clearCache(){this.cache.clear()}async getAnalytics(){return this._fetch("/analytics/overview")}async getAnnualProduction(){return this._fetch("/analytics/annual-production")}async searchWorks(e={}){var t=new URLSearchParams,e=(e.q&&t.append("q",e.q),e.limit&&t.append("limit",e.limit),e.cursor&&t.append("cursor",e.cursor),e.sort&&t.append("sort",e.sort),t.toString());return this._fetch("/works/"+(e?"?"+e:""))}async getWork(e){return this._fetch("/works/"+e)}async searchAuthors(e,t=25){e=new URLSearchParams({name:e,limit:t.toString()});return this._fetch("/authors/search?"+e)}async getAuthor(e){return this._fetch("/authors/"+e)}async getAuthorWorks(e,t=25,r=null){t=new URLSearchParams({limit:t.toString()});return r&&t.append("cursor",r),this._fetch(`/authors/${e}/works?`+t)}async getVenues(e={}){var t=new URLSearchParams,e=(e.limit&&t.append("limit",e.limit),e.offset&&t.append("offset",e.offset),t.toString());return this._fetch("/venues/"+(e?"?"+e:""))}async getVenue(e){return this._fetch("/venues/"+e)}async getVenueWorks(e,t=25,r=null){t=new URLSearchParams({limit:t.toString()});return r&&t.append("cursor",r),this._fetch(`/venues/${e}/works?`+t)}async getWorkMetrics(e){return this._fetch("/metrics/work/"+e)}async getRecentWorks(e=10){return this.searchWorks({q:"*",limit:e,sort:"recent"})}async getTopVenues(e=10){return this.getVenues({limit:e,offset:0})}}let api=new ethnos_appAPI;